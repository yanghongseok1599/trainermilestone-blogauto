import { AppState, SEARCH_INTENT_INFO } from '@/types';

// 검색 의도별 전략 생성
function getSearchIntentStrategy(state: AppState): string {
  const intentInfo = SEARCH_INTENT_INFO[state.searchIntent];

  const strategies: Record<string, string> = {
    information: `
### 검색 의도: 정보형 (Information)
- 의도: "알고 싶다"
- 전략: 서론 최대한 짧게, 정의/방법/리스트 형태로 핵심 요약
- 구조: 질문에 대한 답변을 먼저 제시, 세부 설명은 그 뒤에
- 첫 문단에서 바로 핵심 정보 제공`,

    transaction: `
### 검색 의도: 거래형 (Transaction)
- 의도: "하고 싶다/사고 싶다"
- 전략: 가격 비교표, 할인 정보, 등록 방법을 최상단에 배치
- 구조: 가격/혜택 정보 먼저, 상세 설명은 그 뒤에
- CTA(행동 유도)를 강하게 배치`,

    navigation: `
### 검색 의도: 이동형 (Navigation)
- 의도: "가고 싶다"
- 전략: 구체적 경로, 주차 정보, 대중교통 안내 상세히
- 구조: 찾아오는 방법을 최우선으로 배치
- 지도, 주소, 주차 정보 명확히 제시`,

    location: `
### 검색 의도: 장소형 (Location) - 피트니스 업종 핵심
- 의도: "어디가 좋을까"
- 전략: 위치, 주차, 영업시간, 가격표 등 플레이스 정보 상세 정리
- 구조: 업체 핵심 정보를 먼저, 차별점과 후기로 신뢰 구축
- 다른 곳과 비교했을 때 왜 여기가 좋은지 명확히 제시`
  };

  return `
## 2025년 네이버 SEO 검색 의도 분석

선택된 검색 의도: ${intentInfo.name}
${strategies[state.searchIntent]}
`;
}

export function generate333Prompt(state: AppState): string {
  const subKeywords = state.subKeywords.filter(k => k).join(', ');
  const tailKeywords = state.tailKeywords.filter(k => k).join(', ');
  const imageAnalyses = state.images
    .filter(img => img.analysis)
    .map((img, idx) => `[이미지 ${idx + 1} 분석]\n${img.analysis}`)
    .join('\n\n');

  const searchIntentStrategy = getSearchIntentStrategy(state);

  // 페르소나 & 타겟 정보
  const personaInfo = state.writerPersona
    ? `\n## 글쓴이 페르소나 (필수 반영)\n이 글은 "${state.writerPersona}" 시점에서 작성합니다.\n- 1인칭 시점으로 자연스럽게 경험을 녹여서 작성\n- 해당 페르소나가 실제로 느꼈을 감정과 경험을 구체적으로 표현`
    : '';

  const targetInfo = state.targetReader
    ? `\n## 타겟 독자 (필수 반영)\n이 글의 독자는 "${state.targetReader}"입니다.\n- 이 독자가 궁금해할 정보를 우선 제공\n- 이 독자의 고민과 니즈에 공감하는 문장 포함\n- 이 독자가 행동하도록 유도하는 CTA 작성`
    : '';

  return `당신은 2025년 네이버 통합검색 SEO에 최적화된 블로그 전문 작가입니다.
'이상한마케팅'의 333 법칙과 FIRE 공식을 완벽하게 구현합니다.

## 입력 정보
- 업종: ${state.category}
- 업체명: ${state.businessName}
- 메인키워드: ${state.mainKeyword}
- 보조키워드: ${subKeywords || '없음'}
- 테일키워드(롱테일): ${tailKeywords || '없음'}
- 타겟고객: ${state.targetAudience || '미지정'}
- 핵심차별점: ${state.uniquePoint || '미지정'}
- 속성정보: ${JSON.stringify(state.attributes, null, 2)}
${personaInfo}${targetInfo}
${imageAnalyses ? `\n## 업로드된 이미지 분석 결과 (반드시 본문에 반영)\n${imageAnalyses}` : ''}

---
${searchIntentStrategy}
---

## 2025년 네이버 SEO 필수 적용 사항

### F-패턴 대응 (필수)
- 사용자는 글을 정독하지 않고 F자 형태로 훑어봄
- 날씨 인사, 주말 이야기 등 불필요한 서론 절대 금지
- 제목을 본문 맨 처음에 복사 붙여넣기 절대 금지 (이탈률 증가 주범)

### 첫 문단 전략 (필수 - 3초 내 이탈 방지)
첫 문단에서 반드시 아래 2가지 중 하나를 선택:

**전략 A: 핵심 답변 즉시 제시**
- 제목에서 약속한 정보를 바로 제공
- 예: "강남역 헬스장 가격은 월 5만원~15만원대입니다. 아래에서 시설별 상세 가격과 추천 이유를 정리했습니다."

**전략 B: 기대감 제시 + 스크롤 유도**
- 독자가 원하는 답이 이 글에 있음을 명확히 알림
- 예: "이 글 하나로 강남역 헬스장 가격, 시설, 위치, 실제 이용 후기까지 한번에 정리해 드리겠습니다."
- 예: "끝까지 읽으시면 가격 비교표와 숨은 할인 정보까지 알려드립니다."

**금지 사항:**
- "안녕하세요~", "오늘은~", "여러분~" 등 인사말로 시작 금지
- 질문만 던지고 답을 미루는 방식 금지 (예: "헬스장 어디가 좋을까요?"만 쓰고 끝)
- 제목 복사 금지

### 계단식 구조
제목 → 대주제 → 소주제 → 본문 내용
네이버 AI가 이해하기 쉬운 논리 구조로 작성

---

## FIRE 공식 필수 적용

모든 주장에 FIRE 공식을 자연스럽게 적용하세요:

F (Fact): 정확한 스펙, 수치, 데이터
I (Interpretation): 왜 좋은지/나쁜지 해석
R (Real): 직접 겪은 구체적 상황
E (Experience): '찐' 경험 디테일

중요: 본문에 (Fact), (Interpretation), (Real), (Experience) 같은 괄호 레이블을 절대 표시하지 마세요!
FIRE 요소들을 자연스러운 문장으로 녹여서 작성하세요.

예시:
- 나쁜 예: "시설이 좋아요"
- 괄호 레이블 사용 (금지): "러닝머신 20대(Fact)로 대기가 없습니다(Interpretation)."
- 올바른 예: "러닝머신 20대, 프리웨이트 존 50평 규모로 퇴근 후 피크타임에도 기구 대기가 없습니다. 3개월간 주 5회 이용하며 단 한 번도 대기한 적 없었고, 1시간 안에 루틴을 마칠 수 있어 시간 효율이 높았습니다."

---

## 333 법칙 적용

### 1. 헤드라인 (3초의 승부)
- 메인키워드 포함 제목 3가지 안
- 구체적 수치/결과 포함 (추상적 표현 금지)
- 클릭을 유발하는 호기심 또는 명확한 이득

### 2. 본문 흐름 (3단 논리)
1) 문제 제기: 타겟 고객의 고통과 불안 묘사
2) 해결책: 업체의 차별점, 전문성 강조 (FIRE 적용)
3) 가치 입증: 후기, 데이터, 증거 배치

### 3. CTA (행동 유도)
- 희소성/긴급성 메시지
- 클릭 유발 버튼 문구

---

## 키워드 전략

- 메인키워드 "${state.mainKeyword}"를 제목, 첫문단, 본문에 자연스럽게 배치
- 키워드 반복 횟수 강박 금지 (AI는 맥락을 이해함)
- 유의어, 연관어를 풍부하게 사용
- 보조키워드도 본문 전체에 자연스럽게 분포
- 테일키워드(롱테일): ${tailKeywords || '없음'} - 본문과 FAQ에 자연스럽게 녹여서 사용

### 키워드 피로도 방지 (필수)
- 동일한 키워드가 연속 문장에서 반복되지 않도록 주의
- 한 문단 내 같은 키워드 최대 2회까지만 사용
- 키워드 대신 "이곳", "여기", "해당 센터" 등 대명사/지시어로 자연스럽게 대체
- 업체명도 반복 시 "이곳", "저희 센터" 등으로 변환
- 독자가 읽을 때 어색하거나 광고처럼 느껴지지 않도록 자연스러운 문장 흐름 유지

---

## 이미지 삽입 규칙 (필수 - 총 10장 이상)

1. 본문 전체에 걸쳐 최소 10개 이상의 이미지 위치를 [이미지: 설명] 형식으로 표시
2. 업로드된 이미지 분석 결과가 있다면 반드시 해당 내용을 본문에 자연스럽게 반영
3. 텍스트 주장과 사진 증거가 일치하도록 구성

### 이미지 설명 작성 규칙 (매우 중요):
- 이미지 설명은 본문 내용과 직접 연결되어야 함
- 추상적 표현 금지, 구체적이고 상세하게 작성
- 본문에서 언급한 시설, 기구, 서비스명을 그대로 사용

**좋은 예시:**
- [이미지: 러닝머신 20대와 사이클 10대가 배치된 넓은 유산소 존]
- [이미지: PT 전문 트레이너가 회원에게 스쿼트 자세를 교정하는 모습]
- [이미지: 월 5만원부터 시작하는 3개월 등록 할인 가격표]
- [이미지: 50평 규모의 프리웨이트 존에서 덤벨 운동하는 모습]
- [이미지: 지하 주차장 50대 수용 가능한 넓은 주차 공간]

**나쁜 예시:**
- [이미지: 시설 사진] - 너무 추상적
- [이미지: 운동 모습] - 구체적이지 않음
- [이미지: 가격] - 상세 정보 없음

### 권장 이미지 유형 (본문 내용에 맞게 10장 선택):
- 업체 외관/건물 전경
- 메인 운동 공간 전체 모습
- 특정 운동 기구/장비 클로즈업
- 트레이너/강사 프로필 또는 지도 모습
- 그룹 수업/PT 진행 장면
- 회원 후기/비포애프터 결과
- 가격표/이용권/프로모션 안내
- 주차장/로비/접수처
- 샤워실/락커룸/편의시설
- 업체만의 특별한 시설이나 차별점

---

## 출력 형식 규칙 (필수 준수 - 위반 시 전체 다시 작성)

1. 마크다운 문법 절대 사용 금지:
   - # ## ### 등 헤딩 태그 사용 금지
   - ** __ 등 볼드/이탤릭 마크다운 절대 사용 금지 (별표 두개 금지)
   - | | | 등 표 문법 사용 금지
   - 코드블록 사용 금지
   - 이모지 사용 금지
   - ━━━ 같은 특수문자 구분선 사용 금지

2. 괄호로 영어 표현 추가 절대 금지 (매우 중요 - 위반시 재작성):
   - (Fact), (fact), (FACT) 등 대소문자 상관없이 절대 금지
   - (Real), (real), (Experience), (experience) 절대 금지
   - (Interpretation), (interpretation) 절대 금지
   - (Real & Experience), (R&E), (F), (I), (R), (E) 절대 금지
   - (Fact+Interpretation), (Real+Experience) 등 조합도 금지
   - 어떤 문장 뒤에도 (영어 설명) 형태로 추가 설명 금지
   - 모든 내용은 순수 한글로만 작성
   - 괄호 안에 영어 단어 넣지 않기
   - FIRE 공식은 자연스러운 문장으로만 표현하고 레이블은 절대 붙이지 않기

3. 구분선 사용 (필수):
   - 각 【섹션】 사이에 반드시 아래 형식의 구분선을 추가:

────────────────────────────────

   - 이 구분선은 네이버 블로그 붙여넣기 시 바로 구분선으로 인식됨
   - 섹션 제목: 【제목】 형식
   - 목록: 1. 2. 3. 또는 • 사용
   - 정보: 세로 나열

4. 네이버 블로그 에디터에 바로 붙여넣기 가능한 형태로 작성

5. 이미지 위치 표시: [이미지: 구체적인 사진 설명] 형식으로 작성

---

## 출력 형식 (이 형식을 따라 작성 - 구분선 필수)

【제목 후보】
1. (제목1 - 메인키워드 + 구체적 수치/결과)
2. (제목2 - 호기심 유발형)
3. (제목3 - 명확한 이득 제시형)

────────────────────────────────

【목차】
1. (첫 번째 대주제)
2. (두 번째 대주제)
3. (세 번째 대주제)
4. 자주 묻는 질문
5. 마무리

────────────────────────────────

【첫 문단 - 핵심 결론 또는 기대감】
(인사말 없이 바로 시작 - 아래 2가지 중 택1)
[전략A] 제목의 답을 바로 제시: "OO은 ~입니다. 아래에서 자세히 알려드리겠습니다."
[전략B] 기대감 제시: "이 글에서 OO의 가격, 시설, 후기까지 한번에 정리해 드립니다."
(메인키워드 자연스럽게 포함)
(독자가 "이 글에 내가 찾는 정보가 있겠구나" 확신하게 작성)

[이미지: 업체 외관 또는 대표 사진]

────────────────────────────────

【${state.businessName} 핵심 정보】
• 업체명: ${state.businessName}
• 위치: (주소)
• 평일 운영: (평일 운영시간)
• 주말 운영: (주말 운영시간)
• 공휴일/휴무: (공휴일 운영 및 휴무일 정보)
• 주차: (주차 정보)
• 가격: (가격대)
• 특징: (핵심 차별점)

────────────────────────────────

【본문 - 문제 제기】
(타겟 고객의 고민을 공감하는 문단 - 자연스러운 문장으로 작성)

[이미지: 고객 고민 상황 관련 사진]

────────────────────────────────

【본문 - 해결책】
(업체만의 차별점과 전문성 - 구체적 수치와 데이터 포함)

[이미지: 시설/서비스/전문가 사진]

────────────────────────────────

【본문 - 가치 입증】
(실제 후기, 데이터, 증거)

[이미지: 후기/비포애프터/수료증 사진]

────────────────────────────────

【자주 묻는 질문】
Q. (검색자가 궁금해할 질문 1)
A. (구체적 답변)

Q. (질문 2)
A. (답변)

Q. (질문 3)
A. (답변)

────────────────────────────────

【${state.category} 선택 체크리스트】
(저장하고 싶은 체크리스트 형태로 작성)
• 체크항목 1
• 체크항목 2
• 체크항목 3
• 체크항목 4
• 체크항목 5

────────────────────────────────

【문의 안내】
(CTA - 희소성/긴급성 메시지)
(연락처/예약방법)
(지금 문의해야 하는 이유)

────────────────────────────────

【한눈에 보는 ${state.businessName} 요약】
${state.businessName}은(는) ${state.mainKeyword} 지역에서
(업체의 핵심 장점 2-3가지를 간결하게 요약)

• 위치: (주소)
• 평일: (평일 운영시간) / 주말: (주말 운영시간)
• 휴무: (휴무일 정보)
• 특징: (핵심 차별점)
• 가격: (가격 정보)

위 요약 카드 이미지를 함께 첨부하면 더욱 효과적입니다!


---
## 최종 체크 (출력 전 확인 - 하나라도 위반 시 다시 작성)
1. 첫 문단에 인사말 없이 핵심부터 시작했는가?
2. 제목을 본문에 복사하지 않았는가?
3. FIRE 공식을 자연스러운 문장으로 녹여서 작성했는가? (레이블 없이)
4. 계단식 구조(제목→대주제→소주제)가 명확한가?
5. 유의어/연관어를 풍부하게 사용했는가?
6. 업로드된 이미지 분석 결과를 본문에 반영했는가?
7. ** 별표 두개(볼드 마크다운) 사용하지 않았는가? (절대 금지)
8. (Fact), (fact), (Real), (Experience) 등 괄호 영어 표현 사용하지 않았는가? (절대 금지)
9. 마크다운 문법과 이모지를 사용하지 않았는가?
10. 각 섹션 사이에 ──────────────────────────────── 구분선을 추가했는가? (필수)
11. 같은 키워드/업체명이 연속 반복되어 피로감을 주지 않는가?
12. [이미지: 설명] 형식의 이미지 프롬프트가 10개 이상 포함되었는가?

모든 내용은 한국어로 작성하세요.
위 출력 형식을 반드시 따르세요.
【】 형식의 섹션 제목만 사용하세요.
섹션 사이에 ──────────────────────────────── 구분선을 필수로 추가하세요.
━━━ 같은 특수문자 구분선은 사용하지 마세요.`;
}

export function generateModifyPrompt(originalContent: string, userRequest: string): string {
  return `당신은 블로그 글 수정 전문가입니다. 기존 글을 사용자 요청에 맞게 수정해주세요.

## 기존 블로그 글:

${originalContent}

---

## 사용자 수정 요청: ${userRequest}

---

## 필수 수정 규칙:

### 1. 이미지 프롬프트 유지 (매우 중요)
- 기존 글에 있는 [이미지: ...] 형식을 모두 유지해야 합니다
- 수정 후에도 본문 내용에 맞는 이미지 프롬프트가 10개 이상 포함되어야 합니다
- 이미지 설명은 본문 내용과 직접 연관되게 구체적으로 작성
- 예: [이미지: 넓은 유산소 존에서 러닝머신을 이용하는 회원 모습]

### 2. 구분선 추가 (필수)
- 각 【섹션】 사이에 반드시 아래 형식의 구분선을 추가하세요:

────────────────────────────────

- 이 구분선은 네이버 블로그 붙여넣기 시 섹션 구분을 위해 필수입니다

### 3. 절대 금지 사항 (위반 시 전체 다시 작성)
- (Fact), (fact), (Real), (Experience), (Interpretation) 등 영어 괄호 레이블 절대 금지
- (Real & Experience), (F), (I), (R), (E) 등 FIRE 약자 표기 절대 금지
- ** 볼드 마크다운 절대 금지
- # ## ### 헤딩 마크다운 절대 금지
- 이모지 절대 금지
- ━━━ 특수 구분선 금지 (위의 ──── 형식만 사용)

### 4. 형식 유지
- 【】 형식의 섹션 제목 유지
- 각 섹션 사이에 구분선과 빈 줄 추가
- 네이버 블로그에 바로 붙여넣기 가능한 형태로 작성

### 5. 전체 글 출력
- 수정된 전체 글을 처음부터 끝까지 출력하세요
- 일부만 출력하지 말고 전체를 출력하세요

모든 내용은 순수 한글로만 작성하세요.
FIRE 공식의 내용은 자연스러운 문장으로 녹여서 작성하고, 괄호 레이블은 절대 사용하지 마세요.`;
}
